<!DOCTYPE html>
<html lang="fr">
  <head>  
    <meta charset="UTF-8">
    <title>Mon Espace Ksos</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header class="top-bar">
      <h1>👤 Mon Espace Ksos</h1>
      <a href="index.html">← Retour à l’accueil</a>

      <div id="auth-bar">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Mot de passe">
        <button id="signup">Créer un compte</button>
        <button id="login">Se connecter</button>
        <button id="logout" style="display:none;">Se déconnecter</button>
        <div id="user-info"></div>
      </div>
    </header>
    <main>

      <section id="contact-section">
        <h2>Nous soummettre vos texte / Nous contacter</h2>
        <form id="contact-form">
          <input type="email" id="from_email" placeholder="Ton email" required>
          <textarea id="message" rows="5" placeholder="Ton message ici..." required></textarea>
          <button type="submit">Envoyer</button>
        </form>
        <p id="mail-status"></p>
      </section>
      
      <section id="favorites-section">
        <h2>📚 Mes favoris</h2>
        <div id="favorites-list" class="favorites-zone"></div>
      </section>
    </main>

    <footer>
      <p>© Ksos - Tous droits réservés</p>
    </footer>
    
    <script type="module" src="main.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAimK0CJsMXb1EqBtfqB36hrEunO4Ybk3c",
        authDomain: "bibliothequekassossiale.firebaseapp.com",
        projectId: "bibliothequekassossiale",
        storageBucket: "bibliothequekassossiale.firebasestorage.app",
        messagingSenderId: "1029476191647",
        appId: "1:1029476191647:web:4da50f87d9aacc635b81aa",
        measurementId: "G-83CKLXJJHD"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const userInfo = document.getElementById("user-info");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          const data = userDoc.data();

         userInfo.innerHTML = `
            <p>👋 Bonjour <strong>${data.prenom} ${data.nom}</strong> !</p>
            <p>Pseudo : ${data.pseudo}</p>
            <p>Email : ${data.email}</p>
          `;
        } else {
          userInfo.innerHTML = "<p>Tu n'es pas connecté.</p>";
        }
      });
    </script>
  </body>
</html>
